---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Hero from "../../components/Hero.astro";
import Sidebar from "../../components/Sidebar.astro";
import Footer from "../../components/Footer.astro";
import Pagination from "../../components/Pagination.astro";
import ArticleList from "../../components/ArticleList.astro";
import { POSTS_PER_PAGE } from "../../config/config.mts";

export const getStaticPaths = (async () => {
    const allPosts = await getCollection("blog");
    const baseLink = "/";
	const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
	
    const sortedPosts = allPosts.sort((a, b) => new Date(b.data.date as any).getTime() - new Date(a.data.date as any).getTime());
	const postsFronSecondPage = sortedPosts.slice(POSTS_PER_PAGE);
    const totalSlicedPages = Math.ceil(postsFronSecondPage.length / POSTS_PER_PAGE);
	
    return [...Array(totalSlicedPages)].map((_, index) => {
        return {
            params: { page: `${index + 2}` },
            props: { 
                posts: postsFronSecondPage.slice(index * POSTS_PER_PAGE, (index + 1) * POSTS_PER_PAGE),
                currentPage: index + 2,
                totalPages: totalPages,
                baseLink: baseLink,
            },
        };
    });

}) satisfies GetStaticPaths;

const { posts, currentPage, totalPages, baseLink } = Astro.props;

---

<BaseLayout title="个人博客 | My Blog">
	<Hero />
	
	<div class="container">
		<main>
			<ArticleList posts={posts} />
            <Pagination currentPage={currentPage} totalPages={totalPages} baseLink={baseLink} />
		</main>

		<Sidebar />
	</div>

	<Footer />
</BaseLayout>

<style>

	/* ===== 主容器布局 (Grid) ===== */
	.container {
		max-width: 1100px;
		margin: 0 auto;
		padding: 20px;
		display: grid;
		grid-template-columns: 3fr 1fr;
		gap: 30px;
	}

	/* ===== 响应式 ===== */
	@media (max-width: 768px) {
		.container {
			grid-template-columns: 1fr;
		}
		Sidebar {
			order: 1;
		}
		main {
			order: 2;
		}
	}
</style>
